name: Find IPTV Key
on: workflow_dispatch
jobs:
  find_key:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: 🐍 Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.10"
    - name: 🔄 Use pycryptodomex instead
      run: |
        pip uninstall -y pycryptodome
        pip install pycryptodomex
        sed -i 's/from Crypto.Cipher import DES3/from Cryptodome.Cipher import DES3/' get_iptv_channels.py
    - name: 🔍 Verify patch
      run: |
        python -c "
        from Crypto.Cipher import DES3
        try:
            DES3.adjust_key_parity(b'\x00'*24)
            print('✅ 补丁已成功应用')
        except ValueError:
            print('❌ 补丁未生效')
        except Exception as e:
            print(f'⚠️ 其他错误: {e}')
        "

    - name: 🚀 Run Script
      run: |
        pip install pycryptodome requests
        python get_iptv_channels.py
