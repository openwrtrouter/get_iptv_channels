name: Find IPTV Key
on: workflow_dispatch
jobs:
  find_key:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: ğŸ Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.10"
    - name: ğŸ”„ Use pycryptodomex instead
      run: |
        pip uninstall -y pycryptodome
        pip install pycryptodomex
        sed -i 's/from Crypto.Cipher import DES3/from Cryptodome.Cipher import DES3/' get_iptv_channels.py
    - name: ğŸ” Verify patch
      run: |
        python -c "
        from Crypto.Cipher import DES3
        try:
            DES3.adjust_key_parity(b'\x00'*24)
            print('âœ… è¡¥ä¸å·²æˆåŠŸåº”ç”¨')
        except ValueError:
            print('âŒ è¡¥ä¸æœªç”Ÿæ•ˆ')
        except Exception as e:
            print(f'âš ï¸ å…¶ä»–é”™è¯¯: {e}')
        "

    - name: ğŸš€ Run Script
      run: |
        pip install pycryptodome requests
        python get_iptv_channels.py
